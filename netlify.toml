
[build]
  # Use `npm ci` (deterministic) without `--no-optional` so optional native binaries can be installed.
  # Ensure package-lock.json was generated on Node 20 locally and committed so `npm ci` will reproduce the same install.
  command = "npm ci --prefix frontend && npm run build --prefix frontend"
  publish = "frontend/dist"

[build.environment]
  # Set Node version to 20 to match Vite and Netlify's supported versions
  NODE_VERSION = "20"
  # Do NOT disable optional deps here; we need platform-specific binaries for Rollup.
  # Keep NODE_VERSION=20 so Netlify uses Node 20 runtime.

[dev]
  framework = "vite"
